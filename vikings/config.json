{
  "tables": {
    "dimension": [
      "drop",
      "monster",
      "equipment",
      "boost",
      "equipment_slot",
      "equipment_type"
    ],
    "bridge": [
      "monster_drop",
      "equipment_material_subequipment"
    ],
    "fact": [
      {
        "name": "drop_boosts",
        "levels": 6
      },
      {
        "name": "equipment_boosts",
        "levels": 6
      }
    ],
    "custom": [
      {
        "name": "equipment_materials",
        "columns": [
          {"equipment_0_id": "INTEGER"},
          {"equipment_1_id": "INTEGER"},
          {"equipment_2_id": "INTEGER"},
          {"equipment_3_id": "INTEGER"},
          {"equipment_4_id": "INTEGER"},
          {"equipment_5_id": "INTEGER"},
          {"equipment_6_id": "INTEGER"},
          {"equipment_7_id": "INTEGER"},
          {"equipment_8_id": "INTEGER"},
          {"equipment_9_id": "INTEGER"},
          {"material_id": "INTEGER"},
          {"invader_id": "INTEGER"},
          {"uber_invader_id": "INTEGER"}
        ]
      }
    ]
  },
  "views": [
    {
     "material": {
      "source_table": "drop",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_material = 1"
     }
    },
    {
     "stone": {
      "source_table": "drop",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_stone = 1"
     }
    },
    {
     "rune": {
      "source_table": "drop",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_rune = 1"
     }
    },
    {
     "invader": {
      "source_table": "monster",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_uber = 0 AND is_shaman = 0"
     }
    },
    {
     "uber_invader": {
      "source_table": "monster",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_uber = 1"
     }
    },
    {
     "shaman": {
      "source_table": "monster",
      "columns": ["%_id", "%_href", "%_name_%"],
      "data_filter": "is_shaman = 1"
     }
    },
    {
     "subequipment": {
      "source_table": "equipment",
      "columns": ["equipment_id", "equipment_href"]
     }
    }
  ],
  "extra_columns": {
    "drop": [
      {"is_material": "INTEGER"},
      {"is_stone": "INTEGER"},
      {"is_rune": "INTEGER"}
    ],
    "monster": [
      {"is_uber": "INTEGER"},
      {"is_shaman": "INTEGER"}
    ],
    "equipment": [
      {"equipment_slot_id": "INTEGER"},
      {"equipment_type_id": "INTEGER"}
    ]
  },
  "report_views": {
    "best_boost_equipment": "WITH cte AS\n(\nSELECT\n    eb.*\n    ,e.equipment_slot_id\n    ,e.equipment_type_id\n    ,RANK() OVER(\n                    PARTITION BY\n                         eb.boost_id\n                        ,e.equipment_slot_id\n                        ,e.equipment_type_id\n                    ORDER BY\n                        CAST(REPLACE(eb.level_6, '%', '') AS DECIMAL) DESC,\n                        CAST(REPLACE(eb.level_5, '%', '') AS DECIMAL) DESC,\n                        CAST(REPLACE(eb.level_4, '%', '') AS DECIMAL) DESC,\n                        CAST(REPLACE(eb.level_3, '%', '') AS DECIMAL) DESC,\n                        CAST(REPLACE(eb.level_2, '%', '') AS DECIMAL) DESC,\n                        CAST(REPLACE(eb.level_1, '%', '') AS DECIMAL) DESC,\n                        eb.equipment_id DESC\n                ) boost_rank\nFROM\n    equipment_boosts eb\n    LEFT JOIN equipment e\n        ON e.equipment_id = eb.equipment_id\n)\nSELECT\n     boost_id\n    ,equipment_id\n    ,level_1\n    ,level_2\n    ,level_3\n    ,level_4\n    ,level_5\n    ,level_6\n    ,equipment_slot_id\n    ,equipment_type_id\nFROM\n    cte\nWHERE\n    boost_rank = 1"
  }
}